---
title: Прямое и обратное Фурье-преобразования периодического сигнала
author: Воронин Андрей
date: 2018-10-14
---

4 вариант. 

# Дано:
- периодический сигнал (меандр) амплитудой 1 В;
- частота \\(f_0 = 1400\\) Гц;
- частота дискретизации \\(f_d = K \\cdot f_0 \\), \\(K=[0.2; 1.6; 8] \\);
- количество гармоник \\(M = [2, 5, 12]\\);
- количество точек \\(N = 1024\\);
- сигнал содержит 10 периодов

# Задание:
Разложить сигнал в ряд Фурье, построить амплитудную и фазовую спектрограммы, Для каждого из 3-х заданных чисел гармоник M совершить обратное преобразование Фурье. Определить номер наивысшей гармоники, существенной для восстановления сигнала (уровень 0,1), и восстановить сигнал для гармоник, ограниченных  найденной частотой. Для всех случаев вычислить ошибку восстановления (среднее квадратическое отклонение между точным и приближенным значениями).

# Этапы решения задания

## Построение спектра изначального сигнала

Изначальная последовательность задается выражением:

``` Haskell
function :: Double -> Double
function t = fromInteger $ (-1) ^ i
  where
    i = floor (t * f0 * 2)
```

Функция построения графика выглядит следующим образом:
```haskell
plotOriginal =
  toFile fopt "posts/Lab2/Original_signal.svg" $do
    layout_title .= "Original signal"
    setColors [opaque blue]
    plot (line "" [zip discrets signal]) where
      discrets = [0.0, 1.0/fd .. (n-1)/fd]
      signal = map function discrets
      fd = n / (periods * period)
```
где частота дискретизации `fd` подобрана таким образом, чтобы 10 периодов исходного сигнала 
соответствовали 1024 отсчетам

![Рис. 1: Исходный сигнал](Original_signal.svg)

Амплитудный и фазовый спектр можно найти с помощью следующих двух функций:

``` Haskell
ampSpectrum signal = map magnitude $ elems $ rfft $ listArray (0, n-1) signal where
  n = length signal

phaseSpectrum signal = map phase $ elems $ rfft $ listArray (0, n-1) signal where
    n = length signal
```

![Рис. 2: Амплитудный спектр исходного сигнала](Original_spectrum.svg)
На рисунке 2 наблюдается характерная картина для сигнала типа меандр: присутствуют только нечетные гармоники.

![Рис. 3: Фазовый спектр исходного сигнала](Original_phase_spectrum.svg)

Функция которая восстанавливает сигнал по заданному количеству гармоник 
``` Haskell
signalFromHarmonics k signal = map ((*2) . realPart) $ elems $ ifft harmonics where
  spectrum = rfft $ listArray (0, n-1) signal
  harmonics = listArray (0, n-1) $ take k (elems spectrum) ++ replicate (n - k) (0.0 :+ 0.0)
  n = length signal
```
где `k` это количество гармоник дискретного преобразования Фурье. 
\\[f_k = \\frac{k}{T}\\]
где \\(T\\) период времени, в течение которого брались входные данные.

Для рассчета величины ошибки используется функция:
``` Haskell
calculateError s1 s2 = sqrt $ (/n) $ sum $ map (^^2) $ zipWith (-) s1 s2 where 
  n = fromIntegral $ length s1
```

![Рис. 4: Восстановленный сигнал по 2 гармоникам](Original_signal_ifft_1.svg)

Так как спектр меандра не имеет четных частот, на рисунке 2 можно увидеть восстановленный сигнал в виде одной гармоники. Гармоника под номером 2 равна 0.

![Рис. 5: Восстановленный сигнал по 5 гармоникам](Original_signal_ifft_2.svg)

Аналогично рисунку 4, сигнал восстановленный по 5 гармоникам имеет форму суммы трех гармоник. Нулевыми гармониками являются 2 и 4

![Рис. 6: Восстановленный сигнал по 12 гармоникам](Original_signal_ifft_3.svg)

Аналогичная ситуация на рисунке 6.

Для поиска количества гармоник необходимого, чтобы обеспечить ошибку восстановления меньшую, чем `0.1`
используется рекурентная функция
``` Haskell
findMaxHarmonic01 :: [Double] -> Int
findMaxHarmonic01 = helper 0 where
  helper h s1 = 
    if calculateError s1 s2 < 0.1
    then h
    else helper (h+1) s1
    where s2 = signalFromHarmonics h s1
```

![Рис. 7 Восстановленный сигнал с среднеквадратической ошибкой меньше 0.1](Original_signal_ifft_max.svg)

Как видно из рисунка 7 - 30 гармоник достаточно, для восстановления сигнала с заданной точностью.


## Дискретизация сигнала при \\(K = 0.2\\)

Найдем частоту дискретизации сигнала 

\\[fd = K \\cdot f0 = 0.2 \\cdot 1400 \\text{ Гц} = 280 \\text{ Гц} \\]

Проведем операцию дискретизации сигнала
 
![Рис. 8: Продискретизированный сигнал \\(K = 0.2\\](undersamling_signal1.svg)

На рисунке 4 представлен график, который содержит более 1000 периодов оригинального сигнала, 
однако в следствие низкой частоты дискретизации проявляется стробоскопический эффект. В результате на графике представлен лишь один переход сигнала c 1 на -1.

![Рис. 9: Амплитудный спектр сигнала \\(K = 0.2\\)](undersamling_spectrum1.svg)

Спектр данного сигнала повторяет спектр одиночного прямоугольного импульса.

![Рис. 10: Фазовый спектр сигнала \\(K = 0.2\\)](undersamling_phase_spectrum1.svg)


## Дискретизация сигнала при \\(K = 1.6\\)

Найдем частоту дискретизации сигнала 

\\[fd = K \\cdot f0 = 1.6 \\cdot 1400 \\text{ Гц} = 2240 \\text{ Гц} \\]

Проведем операцию дискретизации сигнала
 
![Рис. 11: Продискретизированный сигнал \\(K = 1.6\\)](undersamling_signal2.svg)

![Рис. 12: Амплитудный спектр сигнала \\(K = 1.6\\)](undersamling_spectrum2.svg)

![Рис. 13: Фазовый спектр сигнала \\(K = 1.6\\)](undersamling_phase_spectrum2.svg)


## Дискретизация сигнала при \\(K = 8\\)

Найдем частоту дискретизации сигнала 

\\[fd = K \\cdot f0 = 8 \\cdot 1400 \\text{ Гц} = 11200 \\text{ Гц} \\]

Проведем операцию дискретизации сигнала
 
![Рис. 14: Продискретизированный сигнал \\(K = 8\\)](oversamling_signal.svg)

![Рис. 15: Амплитудный спектр сигнала \\(K = 8\\)](oversamling_spectrum.svg)

![Рис. 16: Фазовый спектр сигнала \\(K = 8\\)](oversamling_phase_spectrum.svg)



